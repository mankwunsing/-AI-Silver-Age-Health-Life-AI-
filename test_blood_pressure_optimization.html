<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡€å£“æ•¸æ“šå„ªåŒ–æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        .input-field {
            @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent;
        }
        .card {
            @apply bg-white rounded-xl shadow-lg p-6;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">è¡€å£“æ•¸æ“šå„ªåŒ–æ¸¬è©¦</h1>
        
        <!-- å„ªåŒ–èªªæ˜ -->
        <div class="card mb-6">
            <h2 class="text-xl font-semibold mb-4">å„ªåŒ–èªªæ˜</h2>
            <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded">
                <div class="flex items-center">
                    <i class="fa fa-check-circle text-green-500 mr-2"></i>
                    <p class="text-green-700">
                        <strong>å„ªåŒ–å®Œæˆ</strong>ï¼šç§»é™¤äº†å€‹äººè³‡æ–™ä¸­é‡è¤‡çš„è¡€å£“è¼¸å…¥æ¬„ä½ï¼Œè¡€å£“æ•¸æ“šç¾åœ¨çµ±ä¸€å¾æ™ºèƒ½è¨­å‚™æ•¸æ“šéŒ„å…¥ä¸­ç²å–
                    </p>
                </div>
            </div>
        </div>

        <!-- æ™ºèƒ½è¨­å‚™æ•¸æ“šéŒ„å…¥ -->
        <div class="card mb-6">
            <h2 class="text-xl font-semibold mb-4">æ™ºèƒ½è¨­å‚™æ•¸æ“šéŒ„å…¥</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">æ”¶ç¸®å£“ (mmHg)</label>
                    <input type="number" id="bp-systolic" placeholder="120" class="input-field" min="60" max="250">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">èˆ’å¼µå£“ (mmHg)</label>
                    <input type="number" id="bp-diastolic" placeholder="80" class="input-field" min="40" max="150">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">è„ˆæ (bpm)</label>
                    <input type="number" id="bp-pulse" placeholder="72" class="input-field" min="30" max="200">
                </div>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-base mb-2">æ¸¬é‡æ™‚é–“</label>
                    <input type="datetime-local" id="device-time" class="input-field">
                </div>
                <div>
                    <label class="block text-base mb-2">å‚™è¨»</label>
                    <textarea id="device-notes" placeholder="ä¾‹å¦‚ï¼šé¤å¾Œæ¸¬é‡ã€é‹å‹•å¾Œæ¸¬é‡ç­‰" class="input-field" rows="3"></textarea>
                </div>
                <button onclick="saveBloodPressureData()" class="w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl text-lg font-bold hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-xl border-2 border-green-400 transform hover:scale-105">
                    <i class="fa fa-save mr-2 text-xl"></i> ğŸ’¾ ä¿å­˜è¡€å£“æ•¸æ“š
                </button>
            </div>
        </div>

        <!-- å€‹äººè³‡æ–™ï¼ˆå·²å„ªåŒ–ï¼‰ -->
        <div class="card mb-6">
            <h2 class="text-xl font-semibold mb-4">å€‹äººè³‡æ–™ï¼ˆå·²å„ªåŒ–ï¼‰</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-base mb-2">å¹´é½¡</label>
                    <input type="number" id="assessment-age" placeholder="è«‹è¼¸å…¥å¹´é½¡" class="input-field">
                </div>
                
                <!-- è¡€å£“æ•¸æ“šæç¤º -->
                <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded">
                    <div class="flex items-center">
                        <i class="fa fa-info-circle text-blue-500 mr-2"></i>
                        <p class="text-sm text-blue-700">
                            <strong>è¡€å£“æ•¸æ“š</strong>ï¼šå°‡å¾æ™ºèƒ½è¨­å‚™æ•¸æ“šéŒ„å…¥ä¸­è‡ªå‹•ç²å–ï¼Œç„¡éœ€åœ¨æ­¤å¡«å¯«
                        </p>
                    </div>
                </div>
                
                <div>
                    <label class="block text-base mb-2">BMI</label>
                    <input type="number" id="assessment-bmi" placeholder="ä¾‹å¦‚ï¼š22.5" class="input-field">
                </div>
                <div>
                    <label class="block text-base mb-2">è¡€ç³– (mg/dL)</label>
                    <input type="number" id="assessment-glucose" placeholder="ä¾‹å¦‚ï¼š100" class="input-field">
                </div>
            </div>
        </div>

        <!-- å¥åº·è©•ä¼°æ¸¬è©¦ -->
        <div class="card mb-6">
            <h2 class="text-xl font-semibold mb-4">å¥åº·è©•ä¼°æ¸¬è©¦</h2>
            <button onclick="runHealthAssessment()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                <i class="fa fa-calculator mr-2"></i>é‹è¡Œå¥åº·è©•ä¼°
            </button>
        </div>

        <!-- æ¸¬è©¦çµæœ -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">æ¸¬è©¦çµæœ</h2>
            <div id="test-results" class="bg-gray-50 p-4 rounded text-sm font-mono">
                <p class="text-gray-500">è«‹å…ˆéŒ„å…¥è¡€å£“æ•¸æ“šï¼Œç„¶å¾Œé‹è¡Œå¥åº·è©•ä¼°...</p>
            </div>
        </div>
    </div>

    <script>
        // ä¿å­˜è¡€å£“æ•¸æ“š
        function saveBloodPressureData() {
            const systolic = parseInt(document.getElementById('bp-systolic').value);
            const diastolic = parseInt(document.getElementById('bp-diastolic').value);
            const pulse = parseInt(document.getElementById('bp-pulse').value);
            const time = document.getElementById('device-time').value || new Date().toISOString().slice(0, 16);
            const notes = document.getElementById('device-notes').value;
            
            if (!systolic || !diastolic || !pulse) {
                document.getElementById('test-results').innerHTML = '<div class="text-red-600">âŒ è«‹å¡«å¯«å®Œæ•´çš„è¡€å£“æ•¸æ“š</div>';
                return;
            }
            
            try {
                const deviceData = {
                    id: Date.now(),
                    type: 'è¡€å‹',
                    device: 'è¡€å‹è®¡',
                    time: time,
                    notes: notes,
                    timestamp: new Date().toISOString(),
                    data: {
                        systolic: systolic,
                        diastolic: diastolic,
                        pulse: pulse,
                        assessment: assessBloodPressure(systolic, diastolic)
                    }
                };
                
                const healthRecords = JSON.parse(localStorage.getItem('healthRecords') || '[]');
                healthRecords.push(deviceData);
                localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
                
                // æ¸…ç©ºè¡¨å–®
                document.getElementById('bp-systolic').value = '';
                document.getElementById('bp-diastolic').value = '';
                document.getElementById('bp-pulse').value = '';
                document.getElementById('device-time').value = '';
                document.getElementById('device-notes').value = '';
                
                document.getElementById('test-results').innerHTML = '<div class="text-green-600">âœ… è¡€å£“æ•¸æ“šä¿å­˜æˆåŠŸï¼ç¾åœ¨å¯ä»¥é‹è¡Œå¥åº·è©•ä¼°</div>';
            } catch (error) {
                document.getElementById('test-results').innerHTML = `<div class="text-red-600">âŒ ä¿å­˜å¤±æ•—: ${error.message}</div>`;
            }
        }

        // è¡€å£“è©•ä¼°
        function assessBloodPressure(systolic, diastolic) {
            if (systolic >= 180 || diastolic >= 110) {
                return { level: 'é«˜è¡€å‹3çº§', color: 'red', advice: 'ç«‹å³å°±åŒ»' };
            } else if (systolic >= 160 || diastolic >= 100) {
                return { level: 'é«˜è¡€å‹2çº§', color: 'orange', advice: 'å»ºè®®å°±åŒ»' };
            } else if (systolic >= 140 || diastolic >= 90) {
                return { level: 'é«˜è¡€å‹1çº§', color: 'yellow', advice: 'æ³¨æ„ç›‘æµ‹' };
            } else if (systolic >= 130 || diastolic >= 85) {
                return { level: 'æ­£å¸¸é«˜å€¼', color: 'blue', advice: 'ä¿æŒå¥åº·' };
            } else if (systolic >= 120 || diastolic >= 80) {
                return { level: 'æ­£å¸¸', color: 'green', advice: 'è‰¯å¥½' };
            } else {
                return { level: 'ç†æƒ³', color: 'green', advice: 'ä¼˜ç§€' };
            }
        }

        // ç²å–æœ€æ–°è¨­å‚™æ•¸æ“š
        function getLatestDeviceData() {
            try {
                const healthRecords = JSON.parse(localStorage.getItem('healthRecords') || '[]');
                const deviceRecords = healthRecords.filter(record => record.device);
                
                const latestData = {
                    bloodPressure: null,
                    heartRate: null,
                    temperature: null,
                    spO2: null
                };
                
                const bpRecords = deviceRecords.filter(record => record.type === 'è¡€å‹' || record.type === 'è¡€å£“').sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                if (bpRecords.length > 0) {
                    const latestBP = bpRecords[0];
                    latestData.bloodPressure = {
                        systolic: latestBP.data.systolic,
                        diastolic: latestBP.data.diastolic,
                        pulse: latestBP.data.pulse,
                        assessment: latestBP.data.assessment,
                        time: latestBP.time
                    };
                }
                
                return latestData;
            } catch (error) {
                console.error('ç²å–è¨­å‚™æ•¸æ“šå¤±æ•—:', error);
                return { bloodPressure: null, heartRate: null, temperature: null, spO2: null };
            }
        }

        // é‹è¡Œå¥åº·è©•ä¼°
        function runHealthAssessment() {
            const age = parseInt(document.getElementById('assessment-age')?.value) || 0;
            const bmi = parseFloat(document.getElementById('assessment-bmi')?.value) || 0;
            const glucose = parseInt(document.getElementById('assessment-glucose')?.value) || 0;
            
            // å¾æ™ºèƒ½è¨­å‚™æ•¸æ“šä¸­ç²å–è¡€å£“æ•¸æ“š
            const deviceData = getLatestDeviceData();
            const systolic = deviceData.bloodPressure?.systolic || 0;
            const diastolic = deviceData.bloodPressure?.diastolic || 0;
            
            if (systolic === 0 || diastolic === 0) {
                document.getElementById('test-results').innerHTML = '<div class="text-yellow-600">âš ï¸ è«‹å…ˆéŒ„å…¥è¡€å£“æ•¸æ“šï¼Œç„¶å¾Œå†é‹è¡Œå¥åº·è©•ä¼°</div>';
                return;
            }
            
            // æ¨¡æ“¬å¥åº·è©•ä¼°
            const riskScore = calculateRiskScore(age, systolic, diastolic, bmi, glucose);
            const riskLevel = getRiskLevel(riskScore);
            
            const result = `
                <div class="space-y-3">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800 mb-2">å¥åº·è©•ä¼°çµæœ</h3>
                        <p class="text-sm text-blue-700">é¢¨éšªè©•åˆ†: ${riskScore.toFixed(2)}</p>
                        <p class="text-sm text-blue-700">é¢¨éšªç­‰ç´š: ${riskLevel}</p>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800 mb-2">ä½¿ç”¨çš„æ•¸æ“š</h3>
                        <ul class="text-sm text-green-700 space-y-1">
                            <li>â€¢ å¹´é½¡: ${age || 'æœªæä¾›'}</li>
                            <li>â€¢ è¡€å£“: ${systolic}/${diastolic} mmHg (ä¾†è‡ªæ™ºèƒ½è¨­å‚™)</li>
                            <li>â€¢ BMI: ${bmi || 'æœªæä¾›'}</li>
                            <li>â€¢ è¡€ç³–: ${glucose || 'æœªæä¾›'}</li>
                        </ul>
                    </div>
                    
                    <div class="text-sm text-gray-600">
                        âœ… è¡€å£“æ•¸æ“šæˆåŠŸå¾æ™ºèƒ½è¨­å‚™éŒ„å…¥ä¸­ç²å–ï¼Œç„¡éœ€é‡è¤‡å¡«å¯«ï¼
                    </div>
                </div>
            `;
            
            document.getElementById('test-results').innerHTML = result;
        }

        // è¨ˆç®—é¢¨éšªè©•åˆ†
        function calculateRiskScore(age, systolic, diastolic, bmi, glucose) {
            let score = 0;
            
            // å¹´é½¡é¢¨éšª
            if (age > 65) score += 0.3;
            else if (age > 50) score += 0.2;
            else if (age > 35) score += 0.1;
            
            // è¡€å£“é¢¨éšª
            if (systolic >= 140 || diastolic >= 90) score += 0.4;
            else if (systolic >= 130 || diastolic >= 85) score += 0.2;
            
            // BMIé¢¨éšª
            if (bmi > 30) score += 0.2;
            else if (bmi > 25) score += 0.1;
            
            // è¡€ç³–é¢¨éšª
            if (glucose > 126) score += 0.3;
            else if (glucose > 100) score += 0.1;
            
            return Math.min(score, 1.0);
        }

        // ç²å–é¢¨éšªç­‰ç´š
        function getRiskLevel(score) {
            if (score >= 0.7) return 'é«˜é¢¨éšª';
            if (score >= 0.4) return 'ä¸­ç­‰é¢¨éšª';
            if (score >= 0.2) return 'ä½é¢¨éšª';
            return 'æ¥µä½é¢¨éšª';
        }

        // é é¢åŠ è¼‰å®Œæˆå¾Œè¨­ç½®é»˜èªæ™‚é–“
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const timeString = now.toISOString().slice(0, 16);
            document.getElementById('device-time').value = timeString;
        });
    </script>
</body>
</html>
