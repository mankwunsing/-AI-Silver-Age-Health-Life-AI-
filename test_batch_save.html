<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰¹é‡ä¿å­˜åŠŸèƒ½æ¸¬è©¦</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        .input-field {
            @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent;
        }
        .card {
            @apply bg-white rounded-xl shadow-lg p-6;
        }
        .bg-primary {
            background-color: #3B82F6;
        }
        .bg-primary:hover {
            background-color: #2563EB;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">æ‰¹é‡ä¿å­˜åŠŸèƒ½æ¸¬è©¦</h1>
        
        <!-- åŠŸèƒ½èªªæ˜ -->
        <div class="card mb-6">
            <h2 class="text-xl font-semibold mb-4">åŠŸèƒ½èªªæ˜</h2>
            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fa fa-info-circle text-blue-400"></i>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm text-blue-700">
                            <strong>æ‰¹é‡ä¿å­˜åŠŸèƒ½ï¼š</strong>å¯ä»¥ä¸€æ¬¡æ€§ä¿å­˜å¤šå€‹è¨­å‚™çš„æ•¸æ“šï¼Œé¿å…é€å€‹ä¿å­˜çš„éº»ç…©
                        </p>
                        <ul class="text-sm text-blue-700 mt-2 ml-4 list-disc">
                            <li>å¡«å¯«è¨­å‚™æ•¸æ“šå¾Œï¼Œé»æ“Š"æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜"</li>
                            <li>å¯ä»¥æ·»åŠ å¤šå€‹ä¸åŒé¡å‹çš„è¨­å‚™æ•¸æ“š</li>
                            <li>æœ€å¾Œé»æ“Š"æ‰¹é‡ä¿å­˜"ä¸€æ¬¡æ€§ä¿å­˜æ‰€æœ‰æ•¸æ“š</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ™ºèƒ½è¨­å‚™æ•¸æ“šéŒ„å…¥æ¸¬è©¦ -->
        <div class="card mb-6">
            <h2 class="text-xl font-semibold mb-4">æ™ºèƒ½è¨­å‚™æ•¸æ“šéŒ„å…¥æ¸¬è©¦</h2>
            
            <!-- è®¾å¤‡é€‰æ‹©æ ‡ç­¾é¡µ -->
            <div class="mb-4">
                <div class="flex space-x-1 bg-gray-100 p-1 rounded-lg">
                    <button id="tab-bp" onclick="switchDeviceTab('bp')" class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors bg-white text-blue-600 shadow-sm">
                        <i class="fa fa-heartbeat mr-2"></i>è¡€å‹è®¡
                    </button>
                    <button id="tab-spo2" onclick="switchDeviceTab('spo2')" class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors text-gray-600 hover:text-gray-800">
                        <i class="fa fa-tint mr-2"></i>è¡€æ°§è®¡
                    </button>
                    <button id="tab-temp" onclick="switchDeviceTab('temp')" class="flex-1 py-2 px-4 text-sm font-medium rounded-md transition-colors text-gray-600 hover:text-gray-800">
                        <i class="fa fa-thermometer-half mr-2"></i>æ¸©åº¦è®¡
                    </button>
                </div>
            </div>

            <!-- è¡€å‹è®¡æ•°æ®å½•å…¥ -->
            <div id="device-bp" class="device-form">
                <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded mb-4">
                    <p class="text-sm text-green-700">
                        <i class="fa fa-info-circle mr-1"></i>
                        å¡«å¯«å®Œè¡€å£“æ•¸æ“šå¾Œï¼Œå¯ä»¥å–®ç¨ä¿å­˜æˆ–æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-heart text-red-500 mr-1"></i>æ”¶ç¼©å‹ (SYS)
                        </label>
                        <div class="relative">
                            <input type="number" id="bp-systolic" placeholder="120" class="input-field pr-8" min="60" max="250">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">mmHg</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-heart text-blue-500 mr-1"></i>èˆ’å¼ å‹ (DIA)
                        </label>
                        <div class="relative">
                            <input type="number" id="bp-diastolic" placeholder="80" class="input-field pr-8" min="40" max="150">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">mmHg</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-heartbeat text-green-500 mr-1"></i>è„‰æ (PULSE)
                        </label>
                        <div class="relative">
                            <input type="number" id="bp-pulse" placeholder="72" class="input-field pr-8" min="30" max="200">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">bpm</span>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-50 p-3 rounded-lg mb-4">
                    <div class="flex items-center">
                        <i class="fa fa-info-circle text-blue-500 mr-2"></i>
                        <span class="text-sm text-blue-700">è¡€å‹è¯„ä¼°ï¼š</span>
                        <span id="bp-assessment" class="text-sm font-medium text-blue-800 ml-2">è¯·è¾“å…¥æ•°æ®</span>
                    </div>
                </div>
                <button onclick="addToBatchSave('bp')" class="w-full py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors mb-2">
                    <i class="fa fa-plus mr-2"></i> æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜
                </button>
            </div>

            <!-- è¡€æ°§è®¡æ•°æ®å½•å…¥ -->
            <div id="device-spo2" class="device-form hidden">
                <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded mb-4">
                    <p class="text-sm text-green-700">
                        <i class="fa fa-info-circle mr-1"></i>
                        å¡«å¯«å®Œè¡€æ°§æ•¸æ“šå¾Œï¼Œå¯ä»¥å–®ç¨ä¿å­˜æˆ–æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-tint text-red-500 mr-1"></i>è¡€æ°§é¥±å’Œåº¦ (%SpO2)
                        </label>
                        <div class="relative">
                            <input type="number" id="spo2-percent" placeholder="98" class="input-field pr-8" min="70" max="100" step="0.1">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-signal text-orange-500 mr-1"></i>çŒæ³¨æŒ‡æ•° (PI%)
                        </label>
                        <div class="relative">
                            <input type="number" id="spo2-pi" placeholder="2.5" class="input-field pr-8" min="0.1" max="20" step="0.1">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-heartbeat text-green-500 mr-1"></i>è„‰æç‡ (PR)
                        </label>
                        <div class="relative">
                            <input type="number" id="spo2-pr" placeholder="72" class="input-field pr-8" min="30" max="200">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">bpm</span>
                        </div>
                    </div>
                </div>
                <div class="bg-green-50 p-3 rounded-lg mb-4">
                    <div class="flex items-center">
                        <i class="fa fa-info-circle text-green-500 mr-2"></i>
                        <span class="text-sm text-green-700">è¡€æ°§è¯„ä¼°ï¼š</span>
                        <span id="spo2-assessment" class="text-sm font-medium text-green-800 ml-2">è¯·è¾“å…¥æ•°æ®</span>
                    </div>
                </div>
                <button onclick="addToBatchSave('spo2')" class="w-full py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600 transition-colors mb-2">
                    <i class="fa fa-plus mr-2"></i> æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜
                </button>
            </div>

            <!-- æ¸©åº¦è®¡æ•°æ®å½•å…¥ -->
            <div id="device-temp" class="device-form hidden">
                <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded mb-4">
                    <p class="text-sm text-green-700">
                        <i class="fa fa-info-circle mr-1"></i>
                        å¡«å¯«å®Œé«”æº«æ•¸æ“šå¾Œï¼Œå¯ä»¥å–®ç¨ä¿å­˜æˆ–æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-thermometer-half text-red-500 mr-1"></i>ä½“æ¸©
                        </label>
                        <div class="relative">
                            <input type="number" id="temp-value" placeholder="36.5" class="input-field pr-8" min="30" max="45" step="0.1">
                            <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">Â°C</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fa fa-map-marker text-blue-500 mr-1"></i>æµ‹é‡éƒ¨ä½
                        </label>
                        <select id="temp-location" class="input-field">
                            <option value="è…‹ä¸‹">è…‹ä¸‹</option>
                            <option value="å£è…”">å£è…”</option>
                            <option value="ç›´è‚ ">ç›´è‚ </option>
                            <option value="è€³æ¸©">è€³æ¸©</option>
                            <option value="é¢æ¸©">é¢æ¸©</option>
                        </select>
                    </div>
                </div>
                <div class="bg-orange-50 p-3 rounded-lg mb-4">
                    <div class="flex items-center">
                        <i class="fa fa-info-circle text-orange-500 mr-2"></i>
                        <span class="text-sm text-orange-700">ä½“æ¸©è¯„ä¼°ï¼š</span>
                        <span id="temp-assessment" class="text-sm font-medium text-orange-800 ml-2">è¯·è¾“å…¥æ•°æ®</span>
                    </div>
                </div>
                <button onclick="addToBatchSave('temp')" class="w-full py-2 bg-orange-500 text-white rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors mb-2">
                    <i class="fa fa-plus mr-2"></i> æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜
                </button>
            </div>

            <!-- é€šç”¨ä¿¡æ¯ -->
            <div class="space-y-4">
                <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fa fa-info-circle text-blue-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-blue-700">
                                å¯ä»¥å–®ç¨ä¿å­˜æˆ–ä½¿ç”¨æ‰¹é‡ä¿å­˜åŠŸèƒ½ä¸€æ¬¡æ€§ä¿å­˜å¤šå€‹è¨­å‚™æ•¸æ“š
                            </p>
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-base mb-2">æµ‹é‡æ—¶é—´</label>
                    <input type="datetime-local" id="device-time" class="input-field">
                </div>
                <div>
                    <label class="block text-base mb-2">å¤‡æ³¨</label>
                    <textarea id="device-notes" placeholder="ä¾‹å¦‚ï¼šé¤åæµ‹é‡ã€è¿åŠ¨åæµ‹é‡ç­‰" class="input-field" rows="3"></textarea>
                </div>
                
                <!-- å–®ç¨ä¿å­˜æŒ‰éˆ• -->
                <button onclick="addDeviceData()" class="w-full py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl text-lg font-bold hover:from-green-600 hover:to-green-700 transition-all duration-300 shadow-xl border-2 border-green-400 transform hover:scale-105">
                    <i class="fa fa-save mr-2 text-xl"></i> ğŸ’¾ ä¿å­˜è®¾å¤‡æ•°æ®
                </button>
            </div>
        </div>

        <!-- æ‰¹é‡ä¿å­˜å€åŸŸ -->
        <div id="batch-save-area" class="card mb-6 hidden">
            <div class="bg-purple-50 border-l-4 border-purple-400 p-4 rounded">
                <div class="flex items-center justify-between">
                    <div>
                        <h4 class="font-semibold text-purple-800">æ‰¹é‡ä¿å­˜åˆ—è¡¨</h4>
                        <p class="text-sm text-purple-700">å·²æ·»åŠ  <span id="batch-count">0</span> é …æ•¸æ“š</p>
                    </div>
                    <div class="space-x-2">
                        <button onclick="clearBatchSave()" class="px-3 py-1 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">
                            <i class="fa fa-trash mr-1"></i>æ¸…ç©º
                        </button>
                        <button onclick="saveBatchData()" class="px-4 py-2 bg-purple-500 text-white rounded-lg font-medium hover:bg-purple-600">
                            <i class="fa fa-save mr-2"></i>æ‰¹é‡ä¿å­˜
                        </button>
                    </div>
                </div>
                <div id="batch-items" class="mt-3 space-y-2">
                    <!-- æ‰¹é‡ä¿å­˜é …ç›®å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                </div>
            </div>
        </div>

        <!-- æ¸¬è©¦çµæœ -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">æ¸¬è©¦çµæœ</h2>
            <div class="space-y-4">
                <button onclick="showStoredData()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    <i class="fa fa-eye mr-2"></i>æŸ¥çœ‹å­˜å„²çš„æ•¸æ“š
                </button>
                <button onclick="clearAllData()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    <i class="fa fa-trash mr-2"></i>æ¸…é™¤æ‰€æœ‰æ•¸æ“š
                </button>
            </div>
            <div id="test-results" class="mt-4 bg-gray-50 p-4 rounded text-sm font-mono"></div>
        </div>
    </div>

    <script>
        // è¨­å‚™æ•¸æ“šéŒ„å…¥åŠŸèƒ½
        let currentDeviceTab = 'bp';
        let batchSaveData = [];

        function switchDeviceTab(device) {
            currentDeviceTab = device;
            
            // æ›´æ–°æ ‡ç­¾é¡µæ ·å¼
            document.querySelectorAll('[id^="tab-"]').forEach(tab => {
                tab.classList.remove('bg-white', 'text-blue-600', 'shadow-sm');
                tab.classList.add('text-gray-600');
            });
            
            const activeTab = document.getElementById(`tab-${device}`);
            if (activeTab) {
                activeTab.classList.remove('text-gray-600');
                activeTab.classList.add('bg-white', 'text-blue-600', 'shadow-sm');
            }
            
            // æ˜¾ç¤º/éšè—å¯¹åº”çš„è¡¨å•
            document.querySelectorAll('.device-form').forEach(form => {
                form.classList.add('hidden');
            });
            
            const activeForm = document.getElementById(`device-${device}`);
            if (activeForm) {
                activeForm.classList.remove('hidden');
            }
        }

        function addDeviceData() {
            const time = document.getElementById('device-time')?.value || new Date().toISOString().slice(0, 16);
            const notes = document.getElementById('device-notes')?.value || '';
            
            let deviceData = null;
            
            switch (currentDeviceTab) {
                case 'bp':
                    deviceData = addBloodPressureData(time, notes);
                    break;
                case 'spo2':
                    deviceData = addSpO2Data(time, notes);
                    break;
                case 'temp':
                    deviceData = addTemperatureData(time, notes);
                    break;
            }
            
            if (deviceData) {
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const healthRecords = JSON.parse(localStorage.getItem('healthRecords') || '[]');
                healthRecords.push(deviceData);
                localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
                
                // æ¸…ç©ºè¡¨å•
                clearDeviceForm();
                
                showMessage('è®¾å¤‡æ•°æ®ä¿å­˜æˆåŠŸï¼', 'success');
            }
        }

        function addToBatchSave(deviceType) {
            const time = document.getElementById('device-time')?.value || new Date().toISOString().slice(0, 16);
            const notes = document.getElementById('device-notes')?.value || '';
            
            let deviceData = null;
            
            switch (deviceType) {
                case 'bp':
                    deviceData = addBloodPressureData(time, notes);
                    break;
                case 'spo2':
                    deviceData = addSpO2Data(time, notes);
                    break;
                case 'temp':
                    deviceData = addTemperatureData(time, notes);
                    break;
            }
            
            if (deviceData) {
                // æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜åˆ—è¡¨
                batchSaveData.push(deviceData);
                updateBatchSaveDisplay();
                showMessage(`${getDeviceTypeName(deviceType)}æ•¸æ“šå·²æ·»åŠ åˆ°æ‰¹é‡ä¿å­˜`, 'success');
            }
        }

        function getDeviceTypeName(deviceType) {
            const names = {
                'bp': 'è¡€å£“',
                'spo2': 'è¡€æ°§',
                'temp': 'é«”æº«'
            };
            return names[deviceType] || deviceType;
        }

        function updateBatchSaveDisplay() {
            const batchArea = document.getElementById('batch-save-area');
            const batchCount = document.getElementById('batch-count');
            const batchItems = document.getElementById('batch-items');
            
            if (batchSaveData.length > 0) {
                batchArea.classList.remove('hidden');
                batchCount.textContent = batchSaveData.length;
                
                batchItems.innerHTML = batchSaveData.map((item, index) => `
                    <div class="flex items-center justify-between bg-white p-2 rounded border">
                        <div class="flex items-center">
                            <i class="fa fa-${getDeviceIcon(item.type)} text-${getDeviceColor(item.type)}-500 mr-2"></i>
                            <span class="text-sm font-medium">${item.type} - ${item.time}</span>
                        </div>
                        <button onclick="removeFromBatch(${index})" class="text-red-500 hover:text-red-700">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                `).join('');
            } else {
                batchArea.classList.add('hidden');
            }
        }

        function getDeviceIcon(type) {
            const icons = {
                'è¡€å‹': 'heartbeat',
                'è¡€æ°§': 'tint',
                'ä½“æ¸©': 'thermometer-half'
            };
            return icons[type] || 'circle';
        }

        function getDeviceColor(type) {
            const colors = {
                'è¡€å‹': 'red',
                'è¡€æ°§': 'green',
                'ä½“æ¸©': 'orange'
            };
            return colors[type] || 'gray';
        }

        function removeFromBatch(index) {
            batchSaveData.splice(index, 1);
            updateBatchSaveDisplay();
        }

        function clearBatchSave() {
            batchSaveData = [];
            updateBatchSaveDisplay();
            showMessage('æ‰¹é‡ä¿å­˜åˆ—è¡¨å·²æ¸…ç©º', 'info');
        }

        function saveBatchData() {
            if (batchSaveData.length === 0) {
                showMessage('æ‰¹é‡ä¿å­˜åˆ—è¡¨ç‚ºç©º', 'error');
                return;
            }
            
            try {
                const savedCount = batchSaveData.length;
                
                // ä¿å­˜æ‰€æœ‰æ•¸æ“šåˆ°æœ¬åœ°å­˜å„²
                const healthRecords = JSON.parse(localStorage.getItem('healthRecords') || '[]');
                healthRecords.push(...batchSaveData);
                localStorage.setItem('healthRecords', JSON.stringify(healthRecords));
                
                // æ¸…ç©ºæ‰¹é‡ä¿å­˜åˆ—è¡¨
                batchSaveData = [];
                updateBatchSaveDisplay();
                
                // æ¸…ç©ºè¡¨å–®
                clearDeviceForm();
                
                showMessage(`æˆåŠŸæ‰¹é‡ä¿å­˜ ${savedCount} é …è¨­å‚™æ•¸æ“š`, 'success');
            } catch (error) {
                console.error('æ‰¹é‡ä¿å­˜å¤±æ•—:', error);
                showMessage('æ‰¹é‡ä¿å­˜å¤±æ•—: ' + error.message, 'error');
            }
        }

        function addBloodPressureData(time, notes) {
            const systolic = parseInt(document.getElementById('bp-systolic')?.value);
            const diastolic = parseInt(document.getElementById('bp-diastolic')?.value);
            const pulse = parseInt(document.getElementById('bp-pulse')?.value);
            
            if (!systolic || !diastolic || !pulse) {
                showMessage('è¯·å¡«å†™å®Œæ•´çš„è¡€å‹æ•°æ®', 'error');
                return null;
            }
            
            const assessment = assessBloodPressure(systolic, diastolic);
            
            return {
                id: Date.now(),
                type: 'è¡€å‹',
                device: 'è¡€å‹è®¡',
                time: time,
                notes: notes,
                timestamp: new Date().toISOString(),
                data: {
                    systolic: systolic,
                    diastolic: diastolic,
                    pulse: pulse,
                    assessment: assessment
                }
            };
        }

        function addSpO2Data(time, notes) {
            const percent = parseFloat(document.getElementById('spo2-percent')?.value);
            const pi = parseFloat(document.getElementById('spo2-pi')?.value);
            const pr = parseInt(document.getElementById('spo2-pr')?.value);
            
            if (!percent || !pi || !pr) {
                showMessage('è¯·å¡«å†™å®Œæ•´çš„è¡€æ°§æ•°æ®', 'error');
                return null;
            }
            
            const assessment = assessSpO2(percent, pi);
            
            return {
                id: Date.now(),
                type: 'è¡€æ°§',
                device: 'è¡€æ°§è®¡',
                time: time,
                notes: notes,
                timestamp: new Date().toISOString(),
                data: {
                    percent: percent,
                    pi: pi,
                    pr: pr,
                    assessment: assessment
                }
            };
        }

        function addTemperatureData(time, notes) {
            const value = parseFloat(document.getElementById('temp-value')?.value);
            const location = document.getElementById('temp-location')?.value;
            
            if (!value || !location) {
                showMessage('è¯·å¡«å†™å®Œæ•´çš„ä½“æ¸©æ•°æ®', 'error');
                return null;
            }
            
            const assessment = assessTemperature(value, location);
            
            return {
                id: Date.now(),
                type: 'ä½“æ¸©',
                device: 'æ¸©åº¦è®¡',
                time: time,
                notes: notes,
                timestamp: new Date().toISOString(),
                data: {
                    value: value,
                    location: location,
                    assessment: assessment
                }
            };
        }

        function assessBloodPressure(systolic, diastolic) {
            if (systolic < 120 && diastolic < 80) {
                return { level: 'æ­£å¸¸', advice: 'è¡€å‹æ­£å¸¸ï¼Œè¯·ä¿æŒè‰¯å¥½ç”Ÿæ´»ä¹ æƒ¯' };
            } else if (systolic < 140 && diastolic < 90) {
                return { level: 'æ­£å¸¸é«˜å€¼', advice: 'è¡€å‹åé«˜ï¼Œå»ºè®®æ§åˆ¶é¥®é£Ÿå’Œé€‚é‡è¿åŠ¨' };
            } else {
                return { level: 'é«˜è¡€å‹', advice: 'è¡€å‹åé«˜ï¼Œå»ºè®®å’¨è¯¢åŒ»ç”Ÿ' };
            }
        }

        function assessSpO2(percent, pi) {
            if (percent >= 95) {
                return { level: 'æ­£å¸¸', advice: 'è¡€æ°§é¥±å’Œåº¦æ­£å¸¸' };
            } else if (percent >= 90) {
                return { level: 'åä½', advice: 'è¡€æ°§é¥±å’Œåº¦åä½ï¼Œå»ºè®®è§‚å¯Ÿ' };
            } else {
                return { level: 'ä¸¥é‡åä½', advice: 'è¡€æ°§é¥±å’Œåº¦ä¸¥é‡åä½ï¼Œå»ºè®®ç«‹å³å°±åŒ»' };
            }
        }

        function assessTemperature(value, location) {
            let normalRange = { min: 36.0, max: 37.2 };
            
            if (location === 'å£è…”') {
                normalRange = { min: 36.3, max: 37.2 };
            } else if (location === 'ç›´è‚ ') {
                normalRange = { min: 36.6, max: 37.6 };
            } else if (location === 'è€³æ¸©') {
                normalRange = { min: 36.1, max: 37.1 };
            }
            
            if (value >= normalRange.min && value <= normalRange.max) {
                return { level: 'æ­£å¸¸', advice: 'ä½“æ¸©æ­£å¸¸' };
            } else if (value > normalRange.max) {
                return { level: 'åé«˜', advice: 'ä½“æ¸©åé«˜ï¼Œå»ºè®®ä¼‘æ¯å¹¶è§‚å¯Ÿ' };
            } else {
                return { level: 'åä½', advice: 'ä½“æ¸©åä½ï¼Œæ³¨æ„ä¿æš–' };
            }
        }

        function clearDeviceForm() {
            // æ¸…ç©ºå½“å‰è®¾å¤‡è¡¨å•
            const currentForm = document.getElementById(`device-${currentDeviceTab}`);
            if (currentForm) {
                const inputs = currentForm.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
            }
            
            // æ¸…ç©ºé€šç”¨ä¿¡æ¯
            document.getElementById('device-time').value = '';
            document.getElementById('device-notes').value = '';
        }

        function showStoredData() {
            const healthRecords = JSON.parse(localStorage.getItem('healthRecords') || '[]');
            const deviceRecords = healthRecords.filter(record => record.device);
            
            let result = `<strong>å­˜å„²çš„æ•¸æ“šï¼š</strong><br>`;
            result += `ç¸½è¨˜éŒ„æ•¸ï¼š${healthRecords.length}<br>`;
            result += `è¨­å‚™è¨˜éŒ„æ•¸ï¼š${deviceRecords.length}<br><br>`;
            
            if (deviceRecords.length > 0) {
                result += `<strong>è¨­å‚™è¨˜éŒ„è©³æƒ…ï¼š</strong><br>`;
                deviceRecords.forEach((record, index) => {
                    result += `${index + 1}. ${record.type} - ${record.time}<br>`;
                    if (record.type === 'è¡€å‹') {
                        result += `   æ”¶ç¸®å£“ï¼š${record.data.systolic} mmHg<br>`;
                        result += `   èˆ’å¼µå£“ï¼š${record.data.diastolic} mmHg<br>`;
                        result += `   è„ˆæï¼š${record.data.pulse} bpm<br>`;
                    } else if (record.type === 'è¡€æ°§') {
                        result += `   è¡€æ°§é£½å’Œåº¦ï¼š${record.data.percent}%<br>`;
                        result += `   çŒæ³¨æŒ‡æ•¸ï¼š${record.data.pi}%<br>`;
                        result += `   è„ˆæç‡ï¼š${record.data.pr} bpm<br>`;
                    } else if (record.type === 'ä½“æ¸©') {
                        result += `   é«”æº«ï¼š${record.data.value}Â°C<br>`;
                        result += `   æ¸¬é‡éƒ¨ä½ï¼š${record.data.location}<br>`;
                    }
                    result += `   è©•ä¼°ï¼š${record.data.assessment.level} - ${record.data.assessment.advice}<br><br>`;
                });
            } else {
                result += `æ²’æœ‰è¨­å‚™è¨˜éŒ„æ•¸æ“š`;
            }
            
            document.getElementById('test-results').innerHTML = result;
        }

        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿ')) {
                localStorage.removeItem('healthRecords');
                batchSaveData = [];
                updateBatchSaveDisplay();
                showMessage('æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤', 'info');
                document.getElementById('test-results').innerHTML = '';
            }
        }

        function showMessage(message, type) {
            const colors = {
                success: 'green',
                error: 'red',
                info: 'blue'
            };
            
            const resultDiv = document.getElementById('test-results');
            resultDiv.innerHTML = `<div class="text-${colors[type]}-600 font-medium">${message}</div>`;
            
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 3000);
        }

        // é é¢åŠ è¼‰å®Œæˆå¾Œè¨­ç½®é»˜èªæ™‚é–“
        document.addEventListener('DOMContentLoaded', function() {
            const now = new Date();
            const timeString = now.toISOString().slice(0, 16);
            document.getElementById('device-time').value = timeString;
        });
    </script>
</body>
</html>
