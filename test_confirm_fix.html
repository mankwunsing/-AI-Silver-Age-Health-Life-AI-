<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirm函数冲突修复测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Confirm函数冲突修复测试</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">修复内容</h2>
            <div class="space-y-3">
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-green-500 rounded-full mr-3"></span>
                    <span>修复了 <code>confirm</code> 变量名冲突问题</span>
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-green-500 rounded-full mr-3"></span>
                    <span>将 <code>const confirm</code> 改为 <code>const userConfirm</code></span>
                </div>
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-green-500 rounded-full mr-3"></span>
                    <span>避免了与浏览器内置 <code>confirm</code> 函数的冲突</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">测试按钮</h2>
            <div class="space-x-4">
                <button onclick="testConfirmFunction()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    测试Confirm函数
                </button>
                <button onclick="testVariableConflict()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    测试变量冲突
                </button>
                <button onclick="testDataCompletenessCheck()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded">
                    测试数据完整性检查
                </button>
            </div>
        </div>

        <div id="test-results" class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">测试结果</h2>
            <div id="results-content" class="text-gray-600">
                点击上方按钮开始测试...
            </div>
        </div>
    </div>

    <script>
        /**
         * 测试修复后的confirm函数使用
         */
        function testConfirmFunction() {
            const resultsDiv = document.getElementById('results-content');
            
            try {
                // 模拟修复后的代码
                const missingData = ['• 年龄', '• 性别', '• BMI指数'];
                
                // 使用修复后的变量名
                const userConfirm = confirm(`以下数据缺失，可能影响评估准确性：\n${missingData.join('\n')}\n\n是否继续生成报告？`);
                
                resultsDiv.innerHTML = `
                    <div class="text-green-600">
                        <h3 class="font-semibold mb-2">✅ Confirm函数测试通过</h3>
                        <p>用户选择: ${userConfirm ? '继续' : '取消'}</p>
                        <p class="text-sm mt-2">修复后的代码正常工作，没有变量名冲突</p>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="text-red-600">
                        <h3 class="font-semibold mb-2">❌ Confirm函数测试失败</h3>
                        <p>错误: ${error.message}</p>
                    </div>
                `;
            }
        }

        /**
         * 测试变量冲突问题
         */
        function testVariableConflict() {
            const resultsDiv = document.getElementById('results-content');
            
            try {
                // 模拟修复前的错误代码
                const missingData = ['• 年龄', '• 性别'];
                
                // 这会创建变量名冲突
                // const confirm = confirm(...); // 错误：与内置函数冲突
                
                // 修复后的正确代码
                const userConfirm = confirm(`测试数据完整性检查：\n${missingData.join('\n')}\n\n是否继续？`);
                
                resultsDiv.innerHTML = `
                    <div class="text-green-600">
                        <h3 class="font-semibold mb-2">✅ 变量冲突测试通过</h3>
                        <p>修复前: <code>const confirm = confirm(...)</code> ❌</p>
                        <p>修复后: <code>const userConfirm = confirm(...)</code> ✅</p>
                        <p class="text-sm mt-2">用户选择: ${userConfirm ? '继续' : '取消'}</p>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="text-red-600">
                        <h3 class="font-semibold mb-2">❌ 变量冲突测试失败</h3>
                        <p>错误: ${error.message}</p>
                    </div>
                `;
            }
        }

        /**
         * 测试数据完整性检查功能
         */
        function testDataCompletenessCheck() {
            const resultsDiv = document.getElementById('results-content');
            
            try {
                // 模拟健康数据
                const healthData = {
                    age: null, // 缺失
                    gender: null, // 缺失
                    bmi: 22.5, // 有数据
                    glucose: null, // 缺失
                    bloodPressure: {
                        systolic: 120,
                        diastolic: 80
                    }
                };
                
                // 检查数据完整性
                const missingData = checkTestDataCompleteness(healthData);
                
                if (missingData.length > 0) {
                    const userConfirm = confirm(`以下数据缺失，可能影响评估准确性：\n${missingData.join('\n')}\n\n是否继续生成报告？`);
                    
                    resultsDiv.innerHTML = `
                        <div class="text-yellow-600">
                            <h3 class="font-semibold mb-2">⚠️ 数据完整性检查</h3>
                            <p>发现 ${missingData.length} 项缺失数据：</p>
                            <ul class="list-disc list-inside mt-2">
                                ${missingData.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                            <p class="mt-2">用户选择: ${userConfirm ? '继续生成报告' : '取消操作'}</p>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="text-green-600">
                            <h3 class="font-semibold mb-2">✅ 数据完整性检查通过</h3>
                            <p>所有必要数据都已填写</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="text-red-600">
                        <h3 class="font-semibold mb-2">❌ 数据完整性检查失败</h3>
                        <p>错误: ${error.message}</p>
                    </div>
                `;
            }
        }

        /**
         * 模拟数据完整性检查函数
         */
        function checkTestDataCompleteness(healthData) {
            const missing = [];
            
            if (!healthData.age) missing.push('• 年龄');
            if (!healthData.gender) missing.push('• 性别');
            if (!healthData.bloodPressure?.systolic || !healthData.bloodPressure?.diastolic) {
                missing.push('• 血压数据（建议使用智能设备数据录入）');
            }
            if (!healthData.bmi) missing.push('• BMI指数');
            if (!healthData.glucose) missing.push('• 血糖值');
            
            return missing;
        }

        // 页面加载时显示欢迎信息
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Confirm函数冲突修复测试页面已加载');
        });
    </script>
</body>
</html>
